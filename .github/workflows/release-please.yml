name: Pre-release
on:
  push:
    branches:
      - main
  pull_request:
    types:
      - closed
jobs:
  release-please:
    runs-on: ubuntu-latest
    steps:
      # - name: Checkout üõéÔ∏è
      #   uses: actions/checkout@v3
      #   with:
      #     fetch-depth: 0
    # # This is the action in this repo! üëá
    # # Note we set an `id` called `release`. We'll use that later...
    # - name: Validate and extract release information
    #   id: release
    #   uses: manovotny/github-releases-for-automated-package-publishing-action@v1.0.0
      # - name: Node
      #   uses: actions/setup-node@v3
      #   with:
      #     node-version: 16
      #     registry-url: 'https://registry.npmjs.org'
      # # install dependencies
      # - name: Install üîß
      #   run: npm ci
      # # test components
      # # - name: Test üß™
      # #   run: npm run test
      # #   env:
      # #     CI: true
      # - name: Publish the package
      #   run: npm dist-tag add next && npm publish --tag next
      #   env: 
      #     NODE_AUTH_TOKEN: ${{ secrets.NPM_AUTOMATION_TOKEN_DTSSTN_LOCAL }}
      - uses: google-github-actions/release-please-action@v3
        id: ga
        with:
          release-type: node
          changelog-types: '[{"type":"feat","section":"Features"},{"type":"fix","section":"Bug Fixes"},{"type":"perf","section":"Performance Improvements"},{"type":"test","section":"Tests"},{"type":"docs","section":"Documentation"},{"type":"build","section":"Build System"},{"type":"ops","section":"CI/CD Changes"},{"type":"chore","section":"Miscellaneous Chores"},{"type":"refactor","section":"Refactored"}]'
          commit-search-depth: 32
          release-search-depth: 3
          prerelease: true
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          # Optional. Commit message for the created commit.
          # Defaults to "Apply automatic changes"
          commit_message: |
            chore: release v${{ steps.ga.outputs.major }}.${{ steps.ga.outputs.minor }}.${{ steps.ga.outputs.patch }}.next
            Release-As: v${{ steps.ga.outputs.major }}.${{ steps.ga.outputs.minor }}.${{ steps.ga.outputs.patch }}.next
          branch: ${{ steps.ga.outputs.pr.headBranchName }}
          tagging_message: v${{ steps.ga.outputs.major }}.${{ steps.ga.outputs.minor }}.${{ steps.ga.outputs.patch }}.next
          push_options: '--force'
          create_branch: false
          skip_fetch: true
          skip_checkout: true